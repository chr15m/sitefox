<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>sitefox.web documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Sitefox</span> <span class="project-version"></span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="README.html"><div class="inner"><span>Readme</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1 branch"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span></span></div></div></li><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sitefox</span></div></div></li><li class="depth-2 branch"><a href="sitefox.auth.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>auth</span></div></a></li><li class="depth-2 branch"><a href="sitefox.db.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>db</span></div></a></li><li class="depth-2 branch"><a href="sitefox.deps.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>deps</span></div></a></li><li class="depth-2 branch"><a href="sitefox.html.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>html</span></div></a></li><li class="depth-2 branch"><a href="sitefox.logging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>logging</span></div></a></li><li class="depth-2 branch"><a href="sitefox.mail.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mail</span></div></a></li><li class="depth-2 branch"><a href="sitefox.reloader.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>reloader</span></div></a></li><li class="depth-2 branch"><a href="sitefox.tracebacks.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tracebacks</span></div></a></li><li class="depth-2 branch"><a href="sitefox.ui.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ui</span></div></a></li><li class="depth-2 branch"><a href="sitefox.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2 current"><a href="sitefox.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree" style="top: -362px;"><span class="top" style="height: 371px;"></span><span class="bottom"></span></span><span>sitefoxtest</span></div></div></li><li class="depth-2"><a href="sitefoxtest.e2etests.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>e2etests</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="sitefox.web.html#var-add-default-middleware"><div class="inner"><span>add-default-middleware</span></div></a></li><li class="depth-1"><a href="sitefox.web.html#var-build-absolute-uri"><div class="inner"><span>build-absolute-uri</span></div></a></li><li class="depth-1"><a href="sitefox.web.html#var-create"><div class="inner"><span>create</span></div></a></li><li class="depth-1"><a href="sitefox.web.html#var-get-named-route"><div class="inner"><span>get-named-route</span></div></a></li><li class="depth-1"><a href="sitefox.web.html#var-is-post.3F"><div class="inner"><span>is-post?</span></div></a></li><li class="depth-1"><a href="sitefox.web.html#var-name-route"><div class="inner"><span>name-route</span></div></a></li><li class="depth-1"><a href="sitefox.web.html#var-reset-routes"><div class="inner"><span>reset-routes</span></div></a></li><li class="depth-1"><a href="sitefox.web.html#var-serve"><div class="inner"><span>serve</span></div></a></li><li class="depth-1"><a href="sitefox.web.html#var-setup-error-handler"><div class="inner"><span>setup-error-handler</span></div></a></li><li class="depth-1"><a href="sitefox.web.html#var-start"><div class="inner"><span>start</span></div></a></li><li class="depth-1"><a href="sitefox.web.html#var-static-folder"><div class="inner"><span>static-folder</span></div></a></li><li class="depth-1"><a href="sitefox.web.html#var-strip-slash-redirect"><div class="inner"><span>strip-slash-redirect</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">sitefox.web</h1><div class="doc"><div class="markdown"><p>Functions to start the webserver and create routes.</p>
</div></div><div class="public anchor" id="var-add-default-middleware"><h3>add-default-middleware</h3><div class="usage"><code>(add-default-middleware app &amp; [session-options])</code></div><div class="doc"><div class="markdown"><p>Set up default express middleware for:</p>
<ul>
<li>Writing rotating logs to <code>logs/access.log</code>.</li>
<li>Setting up sessions in the configured database.</li>
<li>Parse cookies and body.</li>
</ul>
<p>Pass the <code>session-options</code> map to configure the <code>express-sessions</code> package. Sitefox defaults will be shallow-merged with the options map passed in.</p>
</div></div><div class="src-link"><a href="https://github.com/chr15m/sitefox/blob/master/src/sitefox/web.cljs#L47">view source</a></div></div><div class="public anchor" id="var-build-absolute-uri"><h3>build-absolute-uri</h3><div class="usage"><code>(build-absolute-uri req path)</code></div><div class="doc"><div class="markdown"><p>Creates an absolute URL including host and port. Use inside a route: <code>(build-absolute-uri req "/somewhere")</code></p>
</div></div><div class="src-link"><a href="https://github.com/chr15m/sitefox/blob/master/src/sitefox/web.cljs#L155">view source</a></div></div><div class="public anchor" id="var-create"><h3>create</h3><div class="usage"><code>(create)</code></div><div class="doc"><div class="markdown"><p>Create a new express app and add the default middleware.</p>
</div></div><div class="src-link"><a href="https://github.com/chr15m/sitefox/blob/master/src/sitefox/web.cljs#L124">view source</a></div></div><div class="public anchor" id="var-get-named-route"><h3>get-named-route</h3><div class="usage"><code>(get-named-route req route-name)</code></div><div class="doc"><div class="markdown"><p>Retrieve a route that has previously been named.</p>
</div></div><div class="src-link"><a href="https://github.com/chr15m/sitefox/blob/master/src/sitefox/web.cljs#L185">view source</a></div></div><div class="public anchor" id="var-is-post.3F"><h3>is-post?</h3><div class="usage"><code>(is-post? req)</code></div><div class="doc"><div class="markdown"><p>Check whether an express request uses the POST method.</p>
</div></div><div class="src-link"><a href="https://github.com/chr15m/sitefox/blob/master/src/sitefox/web.cljs#L42">view source</a></div></div><div class="public anchor" id="var-name-route"><h3>name-route</h3><div class="usage"><code>(name-route app route route-name)</code></div><div class="doc"><div class="markdown"><p>Attach a name to a route that can be recalled with <code>get-named-route</code>.</p>
</div></div><div class="src-link"><a href="https://github.com/chr15m/sitefox/blob/master/src/sitefox/web.cljs#L179">view source</a></div></div><div class="public anchor" id="var-reset-routes"><h3>reset-routes</h3><div class="usage"><code>(reset-routes app)</code></div><div class="doc"><div class="markdown"><p>Remove all routes in the current app and re-add the default middleware. Useful for hot-reloading code.</p>
</div></div><div class="src-link"><a href="https://github.com/chr15m/sitefox/blob/master/src/sitefox/web.cljs#L114">view source</a></div></div><div class="public anchor" id="var-serve"><h3>serve</h3><div class="usage"><code>(serve app)</code></div><div class="doc"><div class="markdown"><p>Start serving an express app.</p>
<p>Configure <code>BIND_ADDRESS</code> and <code>PORT</code> with environment variables. They default to <code>127.0.0.1:8000</code>.</p>
</div></div><div class="src-link"><a href="https://github.com/chr15m/sitefox/blob/master/src/sitefox/web.cljs#L130">view source</a></div></div><div class="public anchor" id="var-setup-error-handler"><h3>setup-error-handler</h3><div class="usage"><code>(setup-error-handler app template selector view-component &amp; [error-handler-fn])</code></div><div class="doc"><div class="markdown"><p>Sets up an express route to handle 404 and 500 errors. This must be the last handler in your server:</p>
<pre><code class="language-clojure">(defn setup-routes [app]
  (web/reset-routes app)
  ; ... other routes
  ; 404 and 500 error handling
  (web/setup-error-handler app template "main" component-error-page email-error-callback))
</code></pre>
<p>Pass it the express <code>app</code>, an HTML string <code>template</code>, query <code>selector</code> and a Reagent <code>view-component</code>. Optionally pass <code>error-handler-fn</code> which will be called on every 500 error with args <code>req</code>, <code>error</code>. The error <code>view-component</code> will be rendered and inserted into the template at <code>selector</code>.</p>
<p>The error component will receive three arguments: * <code>req</code> - the express request object. * <code>error-code</code> - the exact error code that occurred (e.g. 404, 500 etc.). * <code>error</code> - the error object that was propagated (if any).</p>
<p>Example:</p>
<p><code>(make-error-handler app my-template "main" my-error-component)</code></p>
<p>To have all 500 errors emailed to you and logged use <code>tracebacks/install-traceback-handler</code> and pass it as error-handler-fn.</p>
</div></div><div class="src-link"><a href="https://github.com/chr15m/sitefox/blob/master/src/sitefox/web.cljs#L190">view source</a></div></div><div class="public anchor" id="var-start"><h3>start</h3><div class="usage"><code>(start)</code></div><div class="doc"><div class="markdown"><p>Create a new express app and start serving it. Runs (create) and then (serve) on the result. Returns a promise which resolves with <a href="app host port server">app host port server</a> once the server is running.</p>
</div></div><div class="src-link"><a href="https://github.com/chr15m/sitefox/blob/master/src/sitefox/web.cljs#L145">view source</a></div></div><div class="public anchor" id="var-static-folder"><h3>static-folder</h3><div class="usage"><code>(static-folder app route dir)</code></div><div class="doc"><div class="markdown"><p>Express middleware to statically serve a <code>dir</code> on a <code>route</code> relative to working dir.</p>
</div></div><div class="src-link"><a href="https://github.com/chr15m/sitefox/blob/master/src/sitefox/web.cljs#L108">view source</a></div></div><div class="public anchor" id="var-strip-slash-redirect"><h3>strip-slash-redirect</h3><div class="usage"><code>(strip-slash-redirect req res n)</code></div><div class="doc"><div class="markdown"><p>Express middleware to strip slashes from the end of any URL by redirecting to the non-slash version. Use: `(.use app strip-slash-redirect)</p>
</div></div><div class="src-link"><a href="https://github.com/chr15m/sitefox/blob/master/src/sitefox/web.cljs#L166">view source</a></div></div></div></body></html>